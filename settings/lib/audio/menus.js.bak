const fs = require('fs');
const { pegarAudioAleatorioBuffer } = require('./audiosAleatorios2');

// FunÃ§Ã£o para deletar arquivo (nÃ£o usada no momento, mas Ãºtil)
function DLT_FL(filePath) {
  if (fs.existsSync(filePath)) fs.unlinkSync(filePath);
}

async function menuHandler(tedzinho, from, pushname, date, hora, info, reply, prefix, NomeDoBot) {
  try {
    const imagemMenu = "https://c.top4top.io/p_34483vrql4.jpg";

    // Ãudio do menu
    const audioBuffer = await pegarAudioAleatorioBuffer();
    if (audioBuffer) {
      await tedzinho.sendMessage(from, {
        audio: audioBuffer,
        ptt: true,
        mimetype: "audio/mpeg"
      }, { quoted: info });
    } else {
      console.warn("âš ï¸ Falha ao carregar Ã¡udio do menu.");
      reply("âš ï¸ O Ã¡udio do menu nÃ£o estÃ¡ disponÃ­vel no momento.");
    }

    // Envia imagem com botÃµes interativos
    await tedzinho.sendMessage(from, {
      image: { url: imagemMenu },
      caption: `ã€”ğŸ’¼ã€•â¥² ğ™‰ğ™„ğ˜¾ğ™†: ${pushname}\nã€”ğŸ“…ã€•â¥² ğ˜¿ğ˜¼ğ™ğ˜¼: ${date}\nã€”â°ã€•â¥² ğ™ƒğ™Šğ™ğ˜¼: ${hora}\n`,
      footer: `ğŸŒŸ ${NomeDoBot} - Seu assistente dedicado ğŸŒŸ`,
      buttons: [
        {
          buttonId: 'action',
          buttonText: { displayText: 'menu' },
          type: 4,
          nativeFlowInfo: {
            name: 'single_select',
            paramsJson: JSON.stringify({
              title: "Lista completa",
              sections: [
                {
                  title: "ğŸ¤– Comandos do Fenrys",
                  highlight_label: "By Fenrys BOT",
                  rows: [
  { title: "ğŸ“Œ MENU PRINCIPAL", description: "Acesse as informaÃ§Ãµes bÃ¡sicas e os comandos mais usados.", id: `${prefix}menupp` },
  { title: "ğŸ†• MENU DE NOVOS CMD", description: "Menu onde vÃ£o estÃ¡ sempre os comandos novos!!!", id: `${prefix}menunovo` },
  { title: "ğŸ‘‘ MENU DONO", description: "Comandos exclusivos reservados ao proprietÃ¡rio do bot.", id: `${prefix}menudono` },
  { title: "ğŸ›¡ MENU ADMIN", description: "Gerencie e proteja seu grupo com essas funÃ§Ãµes administrativas.", id: `${prefix}menuadm` },
  { title: "ğŸ’ MENU PREMIUM", description: "Acesso VIP a recursos especiais para membros premium.", id: `${prefix}menupremium` },
  { title: "ğŸ­ MENU BRINCADEIRAS", description: "Comandos divertidos e interativos para animar o chat!", id: `${prefix}brincadeiras` },
  { title: "ğŸ“¥ EFEITOS EXTERNOS", description: "Aplique efeitos e brilhe rapidamente usando links externos.", id: `${prefix}Efeitosimg` },
  { title: "ğŸ’° MENU COINS", description: "Gerencie sua economia no bot, ganhe e gaste moedas!", id: `${prefix}menucoins` },
  { title: "âš” MENU RPG", description: "Explore o universo RPG, lute, evolua e venÃ§a desafios!", id: `${prefix}menurpg` } // â† Adicionado aqui
]
                },
                {
                  title: "ğŸ’¸ Apoie o Projeto",
                  highlight_label: "DoaÃ§Ãµes",
                  rows: [
                    { title: "âœ¨ DOAR VIA PIX", description: "Ajude o projeto a crescer com qualquer valor!", id: `${prefix}doar` }
                  ]
                },
                {
                  title: "ğŸ¤ Grupo & parcerias",
                  highlight_label: "Grupo Oficial do BOT",
                  rows: [
                    { title: "ğŸ“± GRUPO OFICIAL", description: "Entre no nosso grupo e fique por dentro das novidades.", id: `${prefix}grupobot` },
                    { title: "ğŸ¤ PARCERIAS", description: "Tem um projeto e quer fazer parceria? Clique aqui!", id: `${prefix}parcerias` }
                  ]
                }
              ]
            })
          }
        }
      ],
      headerType: 1,
      viewOnce: true
    }, { quoted: info });

  } catch (error) {
    console.error("Erro no menu:", error);
    reply("âŒ Ocorreu um erro ao exibir o menu. Tente novamente mais tarde.");
  }
}

module.exports = {
  menuHandler
};